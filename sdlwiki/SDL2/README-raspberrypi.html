<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README-raspberrypi</title>
  <style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
</style>
  <style type="text/css">:root {
color-scheme: dark light; 
}
body {
background-color: white;
padding: 2vw;
color: #333;
max-width: 1200px;
margin: 0 auto;
font-size: 16px;
line-height: 1.5;
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans",
Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
overflow-wrap: break-word;
}
a {
color: #0969da;

}
a:visited {
color: #064998;
}
h1 {
border-bottom: 2px solid #efefef;
}
h2 {
border-bottom: 1px solid #efefef;
}
p {
max-width: 85ch;
}
li {
max-width: 85ch;
}
div.sourceCode {
background-color: #f6f8fa;
max-width: 100%;
padding: 16px;
}
code {
background-color: #f6f8fa;
padding: 0px;
font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas,
"Liberation Mono", monospace;
}
table {
border: 1px solid #808080;
border-collapse: collapse;
}
td {
border: 1px solid #808080;
padding: 5px;
}
tr:nth-child(even) {
background-color: #f6f8fa;
}
.wikitopbanner {
display: flex;
justify-content: space-between;
align-items: center;
background-color: #efefef;
padding: 10px;
margin-bottom: 10px;
width: auto;
}
.wikibottombanner {
background-color: #efefef;
padding: 10px;
margin-top: 10px;
width: auto;
}
.alertBox {
background-color: #f8d7da;
border: 1px solid #f5c6cb;
max-width: 60%;
padding: 10;
margin: auto;
}
.anchorImage {
visibility: hidden;
padding-left: 0.2em;
color: #fff;
}
.anchorText:hover .anchorImage {
visibility: visible;
}
hr {
display: block;
height: 1px;
border: 0;
border-top: 1px solid #efefef;
margin: 1em 0;
padding: 0;
}

@media (prefers-color-scheme: dark) {
body {
color: #e6edf3;
background-color: #0d1117;
}
h1 {
border-color: rgba(48, 54, 61, 0.7);
}
h2 {
border-color: rgba(48, 54, 61, 0.7);
}
hr {
border-color: rgba(48, 54, 61, 0.7);
}
div.sourceCode {
background-color: #161b22;
}
code {
background-color: #161b22;
}
a {
color: #4493f8;
}
a:visited {
color: #2f66ad;
}
table {
border-color: rgba(48, 54, 61, 0.7);
}
td {
border-color: rgba(48, 54, 61, 0.7);
}
tr:nth-child(even) {
background-color: #161b22;
}
.wikitopbanner {
background-color: #263040;
}
.wikibottombanner {
background-color: #263040;
}
.anchorText:hover .anchorImage {
filter: invert(100%);
}
}
@media print {
body {
font-size: 12px;
}
table {
font-size: inherit;
}
a:visited {
color: #0969da;
}
.wikitopbanner,
.anchorText,
.wikibottombanner {
display: none;
}
}
</style>
  <style type="text/css"> code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
{ position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
{ content: attr(title);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; pointer-events: all; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
@media (prefers-color-scheme: dark) {
code span.al { color: #95da4c; font-weight: bold; } 
code span.an { color: #3f8058; } 
code span.at { color: #2980b9; } 
code span.bn { color: #f67400; } 
code span.bu { color: #7f8c8d; } 
code span.ch { color: #3daee9; } 
code span.co { color: #7a7c7d; } 
code span.cv { color: #7f8c8d; } 
code span.cn { color: #27aeae; font-weight: bold; } 
code span.cf { color: #fdbc4b; font-weight: bold; } 
code span.dt { color: #2980b9; } 
code span.dv { color: #f67400; } 
code span.do { color: #a43340; } 
code span.er { color: #da4453; } 
code span.ex { color: #0099ff; font-weight: bold; } 
code span.fl { color: #f67400; } 
code span.fu { color: #8e44ad; } 
code span.im { color: #27ae60; } 
code span.in { color: #c45b00; } 
code span.kw { color: #cfcfc2; font-weight: bold; } 
code span.op { color: #cfcfc2; } 
code span.ot { color: #27ae60; } 
code span.pp { color: #27ae60; } 
code span.sc { color: #3daee9; } 
code span.ss { color: #da4453; } 
code span.st { color: #f44f4f; } 
code span.va { color: #27aeae; } 
code span.vs { color: #da4453; } 
code span.wa { color: #da4453; } 
}</style>
</head>
<body>
<h1 id="raspberry-pi">Raspberry Pi</h1>
<p>Requirements:</p>
<p>Raspbian (other Linux distros may work as well).</p>
<h2 id="features">Features</h2>
<ul>
<li>Works without X11</li>
<li>Hardware accelerated OpenGL ES 2.x</li>
<li>Sound via ALSA</li>
<li>Input (mouse/keyboard/joystick) via EVDEV</li>
<li>Hotplugging of input devices via UDEV</li>
</ul>
<h2 id="raspbian-build-dependencies">Raspbian Build Dependencies</h2>
<p>sudo apt-get install libudev-dev libasound2-dev libdbus-1-dev</p>
<p>You also need the VideoCore binary stuff that ships in /opt/vc for
EGL and OpenGL ES 2.x, it usually comes pre-installed, but in any
case:</p>
<p>sudo apt-get install libraspberrypi0 libraspberrypi-bin
libraspberrypi-dev</p>
<h2 id="neon">NEON</h2>
<p>If your Pi has NEON support, make sure you add -mfpu=neon to your
CFLAGS so that SDL will select some otherwise-disabled highly-optimized
code. The original Pi units don&#39;t have NEON, the Pi2 probably does, and
the Pi3 definitely does.</p>
<h2 id="cross-compiling-from-x86-linux">Cross compiling from x86
Linux</h2>
<p>To cross compile SDL for Raspbian from your desktop machine, you&#39;ll
need a Raspbian system root and the cross compilation tools. We&#39;ll
assume these tools will be placed in /opt/rpi-tools</p>
<pre><code>sudo git clone --depth 1 https://github.com/raspberrypi/tools /opt/rpi-tools</code></pre>
<p>You&#39;ll also need a Raspbian binary image. Get it from: <a href="http://downloads.raspberrypi.org/raspbian_latest">http://downloads.raspberrypi.org/raspbian_latest</a>
After unzipping, you&#39;ll get file with a name like:
&quot;<date>-wheezy-raspbian.img&quot; Let&#39;s assume the sysroot will be built in
/opt/rpi-sysroot.</p>
<pre><code>export SYSROOT=/opt/rpi-sysroot
sudo kpartx -a -v &lt;path_to_raspbian_image&gt;.img
sudo mount -o loop /dev/mapper/loop0p2 /mnt
sudo cp -r /mnt $SYSROOT
sudo apt-get install qemu binfmt-support qemu-user-static
sudo cp /usr/bin/qemu-arm-static $SYSROOT/usr/bin
sudo mount --bind /dev $SYSROOT/dev
sudo mount --bind /proc $SYSROOT/proc
sudo mount --bind /sys $SYSROOT/sys</code></pre>
<p>Now, before chrooting into the ARM sysroot, you&#39;ll need to apply a
workaround, edit $SYSROOT/etc/ld.so.preload and comment out all lines in
it.</p>
<pre><code>sudo chroot $SYSROOT
apt-get install libudev-dev libasound2-dev libdbus-1-dev libraspberrypi0 libraspberrypi-bin libraspberrypi-dev libx11-dev libxext-dev libxrandr-dev libxcursor-dev libxi-dev libxss-dev
exit
sudo umount $SYSROOT/dev
sudo umount $SYSROOT/proc
sudo umount $SYSROOT/sys
sudo umount /mnt</code></pre>
<p>There&#39;s one more fix required, as the libdl.so symlink uses an
absolute path which doesn&#39;t quite work in our setup.</p>
<pre><code>sudo rm -rf $SYSROOT/usr/lib/arm-linux-gnueabihf/libdl.so
sudo ln -s ../../../lib/arm-linux-gnueabihf/libdl.so.2 $SYSROOT/usr/lib/arm-linux-gnueabihf/libdl.so</code></pre>
<p>The final step is compiling SDL itself.</p>
<pre><code>export CC=&quot;/opt/rpi-tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf-gcc --sysroot=$SYSROOT -I$SYSROOT/opt/vc/include -I$SYSROOT/usr/include -I$SYSROOT/opt/vc/include/interface/vcos/pthreads -I$SYSROOT/opt/vc/include/interface/vmcs_host/linux&quot;
cd &lt;SDL SOURCE&gt;
mkdir -p build;cd build
LDFLAGS=&quot;-L$SYSROOT/opt/vc/lib&quot; ../configure --with-sysroot=$SYSROOT --host=arm-raspberry-linux-gnueabihf --prefix=$PWD/rpi-sdl2-installed --disable-pulseaudio --disable-esd
make
make install</code></pre>
<p>To be able to deploy this to /usr/local in the Raspbian system you
need to fix up a few paths:</p>
<pre><code>perl -w -pi -e &quot;s#$PWD/rpi-sdl2-installed#/usr/local#g;&quot; ./rpi-sdl2-installed/lib/libSDL2.la ./rpi-sdl2-installed/lib/pkgconfig/sdl2.pc ./rpi-sdl2-installed/bin/sdl2-config</code></pre>
<h2 id="apps-dont-work-or-poor-videoaudio-performance">Apps don&#39;t work
or poor video/audio performance</h2>
<p>If you get sound problems, buffer underruns, etc, run &quot;sudo
rpi-update&quot; to update the RPi&#39;s firmware. Note that doing so will fix
these problems, but it will also render the CMA - Dynamic Memory Split
functionality useless.</p>
<p>Also, by default the Raspbian distro configures the GPU RAM at 64MB,
this is too low in general, specially if a 1080p TV is hooked up.</p>
<p>See here how to configure this setting: <a href="http://elinux.org/RPiconfig">http://elinux.org/RPiconfig</a></p>
<p>Using a fixed gpu_mem=128 is the best option (specially if you
updated the firmware, using CMA probably won&#39;t work, at least it&#39;s the
current case).</p>
<h2 id="no-input">No input</h2>
<p>Make sure you belong to the &quot;input&quot; group.</p>
<pre><code>sudo usermod -aG input `whoami`</code></pre>
<h2 id="no-hdmi-audio">No HDMI Audio</h2>
<p>If you notice that ALSA works but there&#39;s no audio over HDMI, try
adding:</p>
<pre><code>hdmi_drive=2</code></pre>
<p>to your config.txt file and reboot.</p>
<p>Reference: <a href="http://www.raspberrypi.org/phpBB3/viewtopic.php?t=5062">http://www.raspberrypi.org/phpBB3/viewtopic.php?t=5062</a></p>
<h2 id="text-input-api-support">Text Input API support</h2>
<p>The Text Input API is supported, with translation of scan codes done
via the kernel symbol tables. For this to work, SDL needs access to a
valid console. If you notice there&#39;s no SDL_TEXTINPUT message being
emitted, double check that your app has read access to one of the
following:</p>
<ul>
<li>/proc/self/fd/0</li>
<li>/dev/tty</li>
<li>/dev/tty[0...6]</li>
<li>/dev/vc/0</li>
<li>/dev/console</li>
</ul>
<p>This is usually not a problem if you run from the physical terminal
(as opposed to running from a pseudo terminal, such as via SSH). If
running from a PTS, a quick workaround is to run your app as root or add
yourself to the tty group, then re-login to the system.</p>
<pre><code>sudo usermod -aG tty `whoami`</code></pre>
<p>The keyboard layout used by SDL is the same as the one the kernel
uses. To configure the layout on Raspbian:</p>
<pre><code>sudo dpkg-reconfigure keyboard-configuration</code></pre>
<p>To configure the locale, which controls which keys are interpreted as
letters, this determining the CAPS LOCK behavior:</p>
<pre><code>sudo dpkg-reconfigure locales</code></pre>
<h2 id="opengl-problems">OpenGL problems</h2>
<p>If you have desktop OpenGL headers installed at build time in your
RPi or cross compilation environment, support for it will be built in.
However, the chipset does not actually have support for it, which causes
issues in certain SDL apps since the presence of OpenGL support
supersedes the ES/ES2 variants. The workaround is to disable OpenGL at
configuration time:</p>
<pre><code>./configure --disable-video-opengl</code></pre>
<p>Or if the application uses the Render functions, you can use the
SDL_RENDER_DRIVER environment variable:</p>
<pre><code>export SDL_RENDER_DRIVER=opengles2</code></pre>
<h2 id="notes">Notes</h2>
<ul>
<li>When launching apps remotely (via SSH), SDL can prevent local
keystrokes from leaking into the console only if it has root privileges.
Launching apps locally does not suffer from this issue.</li>
</ul>
</body>
</html>
